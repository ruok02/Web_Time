<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
      <title>ê¼¬ì˜¥! - íšŒì› ì „ìš© í˜ì´ì§€</title>
    
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- í°íŠ¸ ì„¤ì • -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc; /* ì—°í•œ ë°°ê²½ */
        }
        /* ìŠ¤í¬ë¡¤ë°” ë””ìì¸ ê°œì„  (ì„ íƒ ì‚¬í•­) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a8a8a8;
            border-radius: 4px;
        }
    </style>
    <script>
        // ë¡œê·¸ì¸ ì²´í¬ (localStorage ê¸°ë°˜ ê°„ë‹¨ êµ¬í˜„)
        window.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('ko_og_logged_in');
            if (!isLoggedIn) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.');
                window.location.href = '/frontend/public/login.html';
            }
        });
    </script>
</head>

<body class="min-h-screen">
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ: í™”ë©´ ì¤‘ì•™ ì •ë ¬ ë° ë°˜ì‘í˜• ìµœëŒ€ ë„ˆë¹„ ì„¤ì • -->
    <div class="max-w-xl mx-auto p-4 sm:p-6 bg-white shadow-xl min-h-screen">

         <!-- í—¤ë” ë° íƒ€ì´í‹€ -->
        <header class="py-4 border-b-2 border-indigo-100 mb-6">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-indigo-700">
                    <span class="text-4xl">ğŸ“Œ</span> ê¼¬ì˜¥!
                </h1>
                <div class="flex items-center gap-3">
                    <!-- ìƒˆ ì•½ì† ë“±ë¡ ë²„íŠ¼ -->
                    <button id="addAppointmentBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition duration-300 transform hover:scale-105 active:scale-95 text-sm">
                        + ìƒˆ ì•½ì† ë“±ë¡
                    </button>
                    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
                    <button onclick="logout()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-xl shadow-md transition duration-300 text-sm">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
            <p class="text-gray-500 mt-2 text-sm">íšŒì› ì „ìš© ì•½ì† ê´€ë¦¬ í˜ì´ì§€</p>
        </header>

        <!-- ì•½ì† ëª©ë¡ í‘œì‹œ ì˜ì—­ -->
        <main>
            <h2 class="text-xl font-semibold text-gray-800 mb-4">ë‹¤ê°€ì˜¤ëŠ” ì•½ì† ëª©ë¡</h2>
            
            <div id="appointment-list" class="space-y-4">
                <!-- ì—¬ê¸°ì— JavaScriptë¡œ ì•½ì† ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                <p id="empty-message" class="text-center text-gray-500 p-8 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50">
                    ë“±ë¡ëœ ì•½ì†ì´ ì—†ìŠµë‹ˆë‹¤. 'ìƒˆ ì•½ì† ë“±ë¡' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ì•½ì†ì„ ì¡ì•„ë³´ì„¸ìš”!
                </p>
            </div>
        </main>

        <!-- ë©”ì‹œì§€ ëª¨ë‹¬ (alert() ëŒ€ì‹  ì‚¬ìš©) -->
        <div id="message-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 hidden flex items-center justify-center p-4" onclick="closeModal()">
            <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
                <h3 class="text-xl font-bold mb-3 text-red-600">ì•Œë¦¼</h3>
                <p id="modal-message" class="text-gray-700 mb-4"></p>
                <button onclick="closeModal()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg font-semibold transition">í™•ì¸</button>
            </div>
        </div>

    </div>

    <script>
        // ìƒìˆ˜ ì •ì˜: localStorage í‚¤
        const APPOINTMENTS_KEY = 'ko_og_appointments';
        // HTML ìš”ì†Œ ì°¸ì¡°
        const appointmentList = document.getElementById('appointment-list');
        const emptyMessage = document.getElementById('empty-message');
        const addAppointmentBtn = document.getElementById('addAppointmentBtn');
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');

        /**
         * alert() ëŒ€ì‹  ì‚¬ìš©í•  ì‚¬ìš©ì ì§€ì • ë©”ì‹œì§€ ëª¨ë‹¬ í•¨ìˆ˜
         * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€ ë‚´ìš©
         */
        function showMessage(message) {
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        }

        function closeModal() {
            messageModal.classList.add('hidden');
        }

        // 1ì£¼ì°¨ ëª©í‘œ: ë°ì´í„° êµ¬ì¡° ì •ì˜
        // ì•½ì† ê°ì²´ í˜•íƒœ ì˜ˆì‹œ:
        // {
        //     id: 'uuid-123',
        //     title: 'íŒ€í”Œ ê¸°íš íšŒì˜',
        //     date: '2025-11-20', // YYYY-MM-DD
        //     time: '14:00',     // HH:MM
        //     place: 'ì¤‘ì•™ ë„ì„œê´€ 3ì¸µ',
        //     penalty: 'ì§€ê° 1ë¶„ë‹¹ ë²Œê¸ˆ 1000ì›',
        //     status: 'ì˜ˆì •'    // 'ì˜ˆì •', 'ì§„í–‰ ì¤‘', 'ì§€ê° ë°œìƒ', 'ì™„ë£Œ'
        // }


        /**
         * localStorageì—ì„œ ì•½ì† ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ (2ì£¼ì°¨ ëª©í‘œì˜ ì‹œì‘)
         * @returns {Array<Object>} ì €ì¥ëœ ì•½ì† ê°ì²´ ë°°ì—´ (ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´)
         */
        function getAppointments() {
            try {
                const data = localStorage.getItem(APPOINTMENTS_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error("localStorage ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", e);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ëª¨ë‹¬ ëŒ€ì‹  ì½˜ì†”ì— ì¶œë ¥í•˜ê³  ë¹ˆ ë°°ì—´ ë°˜í™˜
                return [];
            }
        }

        /**
         * D-Dayë¥¼ ê³„ì‚°í•˜ì—¬ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
         * @param {string} dateString - ì•½ì† ë‚ ì§œ ('YYYY-MM-DD')
         * @returns {string} D-Day ë¬¸ìì—´
         */
        function calculateDDay(dateString) {
            const today = new Date();
            // ì‹œê°„ ì •ë³´ë¥¼ ì œê±°í•˜ì—¬ ìˆœìˆ˜ ë‚ ì§œë§Œ ë¹„êµ
            today.setHours(0, 0, 0, 0); 
            const appointmentDate = new Date(dateString);
            appointmentDate.setHours(0, 0, 0, 0);
            
            const diffTime = appointmentDate.getTime() - today.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'D-Day ğŸ’¥';
            if (diffDays > 0) return `D-${diffDays}ì¼`;
            return 'ì•½ì† ì§€ë‚¨ ğŸ—“ï¸';
        }

        /**
         * ì•½ì† ëª©ë¡ì„ í™”ë©´ì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜ (2ì£¼ì°¨ ëª©í‘œì˜ í•µì‹¬)
         */
        function renderAppointments() {
            
            const appointments = getAppointments();
            appointmentList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

            if (appointments.length === 0) {
                emptyMessage.classList.remove('hidden');
                appointmentList.appendChild(emptyMessage);
                return;
            }

            emptyMessage.classList.add('hidden');

            // 1. ì•½ì† ë‚ ì§œê°€ ê°€ê¹Œìš´ ìˆœì„œë¡œ ì •ë ¬ (í•„ìˆ˜ UX)
            appointments.sort((a, b) => new Date(a.date) - new Date(b.date));

            appointments.forEach(app => {
                const dDay = calculateDDay(app.date);
                let statusColor = 'bg-indigo-100 text-indigo-700'; // ì˜ˆì •
                
                // D-Day ìƒíƒœì— ë”°ë¼ ì¹´ë“œ ìƒ‰ìƒ ë³€ê²½
                if (dDay.includes('D-Day')) {
                    statusColor = 'bg-yellow-100 text-yellow-700 font-bold';
                } else if (dDay.includes('ì•½ì† ì§€ë‚¨')) {
                    statusColor = 'bg-red-100 text-red-700 opacity-70';
                }

                // ì•½ì† ì¹´ë“œ ìƒì„± (DOM ì¡°ì‘)
                const card = document.createElement('div');
                card.className = `p-4 border-l-4 shadow-lg rounded-xl transition duration-300 hover:shadow-xl cursor-pointer ${statusColor.includes('indigo') ? 'border-indigo-500' : statusColor.includes('yellow') ? 'border-yellow-500' : 'border-red-500'}`;
                card.setAttribute('data-id', app.id);
                
                // í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ (register.htmlì„ ì„ì‹œë¡œ ì‚¬ìš©)
                card.onclick = () => {
                    // ì‹¤ì œ êµ¬í˜„ ì‹œ window.location.href = `detail.html?id=${app.id}`;
                    showMessage(`[${app.title}] ì•½ì† ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (ID: ${app.id})`);
                };

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-lg font-semibold text-gray-900 truncate">${app.title}</h3>
                        <span class="px-3 py-1 text-xs font-bold rounded-full ${statusColor}">${dDay}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">
                        <span class="font-medium">ì¥ì†Œ:</span> ${app.place || 'ë¯¸ì •'}
                    </p>
                    <p class="text-sm text-gray-600 mb-1">
                        <span class="font-medium">ì¼ì‹œ:</span> ${app.date} ${app.time}
                    </p>
                    <p class="text-sm text-gray-600">
                        <span class="font-medium text-red-500">í˜ë„í‹°:</span> ${app.penalty}
                    </p>
                `;
                
                appointmentList.appendChild(card);
            });
        }

                // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('ko_og_logged_in');
                localStorage.removeItem('ko_og_username');
                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'index.html';
            }
        }

        // ì´ˆê¸° í™”ë©´ ë¡œë“œ ì‹œ ì•½ì† ëª©ë¡ ë Œë”ë§
        window.onload = function() {
            // ì„ì‹œ ë°ì´í„° (í…ŒìŠ¤íŠ¸ìš©)
            // localStorage.removeItem(APPOINTMENTS_KEY); // í…ŒìŠ¤íŠ¸ ì‹œ ì£¼ì„ í•´ì œí•˜ì—¬ ë°ì´í„° ì´ˆê¸°í™”
            if (getAppointments().length === 0) {
                const sampleData = [{
                    id: '1', title: 'ì›¹í”„ë¡œì íŠ¸ ë°œí‘œ ì¤€ë¹„', date: '2025-11-06', time: '18:00', place: 'ì œ3ê³µí•™ê´€', penalty: 'ì§€ê° ì‹œ ì•„ë©”ë¦¬ì¹´ë…¸ 1ì”', status: 'ì˜ˆì •'
                }, {
                    id: '2', title: 'íŒ€ì›ê³¼ì˜ ì•½ì† (ë²Œì¹™: ì§œì¥ë©´)', date: '2025-11-25', time: '12:30', place: 'í•™êµ ì‹ë‹¹', penalty: 'ë²Œì¹™: ì§œì¥ë©´ ì˜ê¸°', status: 'ì˜ˆì •'
                }, {
                    id: '3', title: 'ì§€ë‚œ ê³¼ì œ ì œì¶œ', date: '2025-10-30', time: '23:59', place: 'ì˜¨ë¼ì¸', penalty: 'íŒ¨ë„í‹° ì ìš©ë¨', status: 'ì§€ê° ë°œìƒ'
                }];
                localStorage.setItem(APPOINTMENTS_KEY, JSON.stringify(sampleData));
            }
            
            renderAppointments();

            // 'ìƒˆ ì•½ì† ë“±ë¡' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ë“±ë¡ í¼ìœ¼ë¡œ ì´ë™)
            
            addAppointmentBtn.addEventListener('click', () => {
                // ì‹¤ì œ êµ¬í˜„ ì‹œ window.location.href = 'register.html';
                showMessage("ì•½ì† ë“±ë¡ í¼ (register.html) í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. \n(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ êµ¬í˜„ ì˜ˆì •)");
            });
        };

    </script>
</body>

</html>